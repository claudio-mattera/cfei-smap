

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CFEI sMAP Python Library &mdash; CFEI sMAP Python Library 1.2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CFEI sMAP Python Library 1.2.0 documentation" href="index.html"/>
        <link rel="next" title="Reference" href="reference.html"/>
        <link rel="prev" title="CFEI Python sMAP Library" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> CFEI sMAP Python Library
          

          
          </a>

          
            
            
              <div class="version">
                1.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">CFEI sMAP Python Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-instructions">General Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#important-note-about-timezones">Important Note about Timezones</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fetching-data">Fetching Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#note">Note</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#posting-data">Posting Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subscribing-to-real-time-data">Subscribing to real-time data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-local-cache">Enabling Local Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#note-about-asyncio">Note about <em>asyncio</em></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-utility">Command Line Utility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference.html#module-cfei.smap">Reference for <code class="code docutils literal"><span class="pre">cfei.smap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#module-cfei.smap.types">Reference for <code class="code docutils literal"><span class="pre">cfei.smap.types</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#module-cfei.smap.transport">Reference for <code class="code docutils literal"><span class="pre">cfei.smap.transport</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#module-cfei.smap.transport.aiohttp">Reference for <code class="code docutils literal"><span class="pre">cfei.smap.transport.aiohttp</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#module-cfei.smap.cache">Reference for <code class="code docutils literal"><span class="pre">cfei.smap.cache</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timezones.html">Converting to and from Timezones</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="internals.html#structure">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals.html#caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals.html#schema-validation">Schema Validation</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CFEI sMAP Python Library</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>CFEI sMAP Python Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/library.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="cfei-smap-python-library">
<h1>CFEI sMAP Python Library<a class="headerlink" href="#cfei-smap-python-library" title="Permalink to this headline">¶</a></h1>
<p>This is a Python 3 library to interface to <a class="reference external" href="https://pythonhosted.org/Smap/en/2.0/archiver.html">sMAP</a> archivers.
It uses the <a class="reference external" href="https://docs.python.org/3/library/asyncio.html">asyncio</a> framework to connect to the archiver, and it returns <a class="reference external" href="https://pandas.pydata.org/">pandas</a> data-frames and time-series.</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first"><strong>Fetching historical data</strong>.
The user specifies a time interval and a query, and the library returns all time-series that satisfy the query.</p>
<p>The user can also request a single time-series.
In that case, all resulting time-series will be intertwined to generate a single one.
This is useful when time-series are split in multiple streams, e.g., in case of gateway jumps.</p>
</li>
<li><p class="first"><strong>Subscribing to real-time data</strong>.
The user specifies a query and a callback, and the library will call the callback whenever a new reading is available.</p>
<p>Since the library supports IO concurrency, the application can perform other operations, while waiting for new data.</p>
</li>
<li><p class="first"><strong>Posting data</strong>.
The users specifies a set of readings, a source name, a path and a UUID.
It can optionally specify properties and metadata.</p>
<p>A simpler interface is available when posting data to existing streams.
The user specifies only UUIDs and readings, and the library will transparently retrieve and cache source names and paths.</p>
</li>
<li><p class="first"><strong>Concurrent requests</strong>.
The user can instantiate multiple concurrent requests to the sMAP archiver, the library (or, better, the asyncio framework) will execute them in parallel.</p>
<p>A parameter defines how many concurrent requests to execute (default: 10) to not overload the sMAP archiver.
Any further request will be transparently enqueued and executed as soon as a slot is free.</p>
</li>
<li><p class="first"><strong>Local caching</strong>.
Readings can be cached on the local machine.
The library can detect when the requested time interval (or larger) is available locally.
This saves execution time, network traffic and server load.
If the cache does not correspond to the user’s query, it is invalidated and data is automatically fetched from the server.</p>
<p><em>Note</em>: the library cannot detect when readings were replaced/added on the server.
Cache should be used only for immutable historical data, not for data that can change.</p>
</li>
<li><p class="first"><strong>Command line tool</strong>.
The tool can be used to quickly plot single time-series data, or to export to CSV files.</p>
</li>
</ul>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The library is available as three different packages:</p>
<ul>
<li><p class="first">Debian package, usable on Debian/Ubuntu and derivatives (anything that uses <code class="docutils literal"><span class="pre">apt</span></code>/<code class="docutils literal"><span class="pre">apt-get</span></code>).
Install it with the following command (possibly prepended with <code class="docutils literal"><span class="pre">sudo</span></code>).</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span>dpkg -i /path/to/python3-cfei-smap_1.2.0-1_all.deb
</pre></div>
</div>
</li>
<li><p class="first">Python wheel package, usable on Windows and almost every system with a Python 3 distribution.
Install it with the following command (possibly prepended with <code class="docutils literal"><span class="pre">sudo</span></code>, or passing the <code class="docutils literal"><span class="pre">--user</span></code> option).</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span>pip3 install /path/to/cfei_smap-1.1-py3-none-any.whl
</pre></div>
</div>
</li>
<li><p class="first">Tarball source package.
It can be used by maintainers to generate a custom package.</p>
</li>
</ul>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-instructions">
<h3>General Instructions<a class="headerlink" href="#general-instructions" title="Permalink to this headline">¶</a></h3>
<p>This library uses the <a class="reference external" href="https://docs.python.org/3/library/asyncio.html">asyncio</a> framework, and returns <a class="reference external" href="https://pandas.pydata.org/">pandas</a> data-frames and time-series.</p>
<p>Most of the features are available as member functions of objects implementing <code class="docutils literal"><span class="pre">SmapInterface</span></code>.
Clients should first create one of the concrete classes, e.g., <code class="docutils literal"><span class="pre">SmapAiohttpInterface</span></code>, and then call its methods.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cfei.smap</span> <span class="kn">import</span> <span class="n">SmapAiohttpInterface</span>

<span class="o">...</span>

<span class="n">smap</span> <span class="o">=</span> <span class="n">SmapAiohttpInterface</span><span class="p">(</span><span class="s2">&quot;http://hostname.com:8079&quot;</span><span class="p">)</span>

<span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">fetch_readings</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="important-note-about-timezones">
<h3>Important Note about Timezones<a class="headerlink" href="#important-note-about-timezones" title="Permalink to this headline">¶</a></h3>
<p>Whenever using time-series data, proper care should be taken to correctly store and represent timezones.
Unfortunately, many tools lack support for timezones, and many users assume localtime is good enough.
This often results in issues when sharing time-series with other persons, or storing them in databases.
It also causes problems at daylight saving time changes, when the time offset of a timezone changes.
Therefore, this library enforces using timezone-aware datetimes.
Whenever a date is expected, it <em>must</em> be a timezone-aware datetime object in UTC, otherwise an exception will be generated.</p>
<p>This could make things more complicate and cumbersome when users are interested in localtime dynamics, such as occupancy behaviour or price trends, because they have to manually convert to and from UTC.
An example on how to convert back and forth from UTC is included in <a class="reference internal" href="timezones.html#timezones"><span class="std std-ref">Converting to and from Timezones</span></a>.</p>
</div>
<div class="section" id="fetching-data">
<h3>Fetching Data<a class="headerlink" href="#fetching-data" title="Permalink to this headline">¶</a></h3>
<p>To fetch data from sMAP, the caller must specify the interval as a pair of <code class="docutils literal"><span class="pre">datetime</span></code> objects and a <em>where</em> query.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">pytz</span>

<span class="kn">from</span> <span class="nn">cfei.smap</span> <span class="kn">import</span> <span class="n">SmapAiohttpInterface</span>


<span class="n">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">smap</span> <span class="o">=</span> <span class="n">SmapAiohttpInterface</span><span class="p">(</span><span class="s2">&quot;http://hostname.com:8079&quot;</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">where</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Metadata/Location/Building = &#39;MyBuilding&#39; and &quot;</span>
        <span class="s2">&quot;Metadata/Location/Room = &#39;MyRoom&#39; and &quot;</span>
        <span class="s2">&quot;Metadata/Location/Media = &#39;air&#39; and &quot;</span>
        <span class="s2">&quot;Metadata/Location/Media = &#39;co2&#39;&quot;</span>
    <span class="p">)</span>

    <span class="n">readings_by_uuid</span> <span class="o">=</span> <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">fetch_readings</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>

    <span class="c1"># It returns a dict[UUID, pd.Series]</span>

    <span class="n">readings</span> <span class="o">=</span> <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">fetch_readings_intertwined</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>

    <span class="c1"># It returns a single pd.Series obtained by intertwining all the results</span>
</pre></div>
</div>
<div class="section" id="note">
<h4>Note<a class="headerlink" href="#note" title="Permalink to this headline">¶</a></h4>
<p>If there are readings at <code class="docutils literal"><span class="pre">start</span></code> and <code class="docutils literal"><span class="pre">end</span></code> instants, the returned time-series will be defined on the <em>closed</em> interval [<code class="docutils literal"><span class="pre">start</span></code>, <code class="docutils literal"><span class="pre">end</span></code>].
Otherwise, which is a more common scenario, the returned time-series will be defined on the <em>open</em> interval ]<code class="docutils literal"><span class="pre">start</span></code>, <code class="docutils literal"><span class="pre">end</span></code>[.</p>
</div>
</div>
<div class="section" id="posting-data">
<h3>Posting Data<a class="headerlink" href="#posting-data" title="Permalink to this headline">¶</a></h3>
<p>Users can post both data (a sequence of readings, i.e., timestamp, value pairs) and metadata (a set of key, value pairs) to any number of sMAP streams.</p>
<p>There are two options to post data to a stream:</p>
<ol class="arabic">
<li><p class="first">Providing <em>path</em>, <em>source name</em> and <em>UUID</em> (and optionally metadata and properties).
This option can be used to create non-existing streams.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">cfei.smap</span> <span class="kn">import</span> <span class="n">SmapAiohttpInterface</span>

<span class="n">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UUID</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">post_data</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">source_name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Providing only the <em>UUIDs</em>.
In this case the library will retrieve and cache the corresponding <em>path</em> and <em>source name</em>, before actually posting data.
This option is only available if the streams already exist.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">cfei.smap</span> <span class="kn">import</span> <span class="n">SmapAiohttpInterface</span>

<span class="n">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">UUID</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">post_readings</span><span class="p">({</span>
      <span class="n">uuid</span><span class="p">:</span> <span class="n">series</span>
    <span class="p">})</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="subscribing-to-real-time-data">
<h3>Subscribing to real-time data<a class="headerlink" href="#subscribing-to-real-time-data" title="Permalink to this headline">¶</a></h3>
<p>Users can subscribe to sMAP, and be notified of every new available reading.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">from</span> <span class="nn">cfei.smap</span> <span class="kn">import</span> <span class="n">SmapAiohttpInterface</span>


<span class="n">async</span> <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">series</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>


<span class="n">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">smap</span> <span class="o">=</span> <span class="n">SmapAiohttpInterface</span><span class="p">(</span><span class="s2">&quot;http://hostname.com:8079&quot;</span><span class="p">)</span>

    <span class="n">where</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Metadata/Location/Building = &#39;MyBuilding&#39; and &quot;</span>
        <span class="s2">&quot;Metadata/Location/Room = &#39;MyRoom&#39; and &quot;</span>
        <span class="s2">&quot;Metadata/Location/Media = &#39;air&#39; and &quot;</span>
        <span class="s2">&quot;Metadata/Location/Media = &#39;co2&#39;&quot;</span>
    <span class="p">)</span>

    <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="enabling-local-cache">
<h3>Enabling Local Cache<a class="headerlink" href="#enabling-local-cache" title="Permalink to this headline">¶</a></h3>
<p>Pass <code class="docutils literal"><span class="pre">cache=True</span></code> to the <code class="docutils literal"><span class="pre">SmapInterface</span></code> constructor to enable local cache.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cfei.smap</span> <span class="kn">import</span> <span class="n">SmapAiohttpInterface</span>


<span class="n">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">smap</span> <span class="o">=</span> <span class="n">SmapAiohttpInterface</span><span class="p">(</span><span class="s2">&quot;http://hostname.com:8079&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># The first time data are fetched from server and cached locally.</span>
    <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">fetch_readings</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>

    <span class="c1"># The second time they are loaded from local cache.</span>
    <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">fetch_readings</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>

    <span class="c1"># This interval is strictly contained in the previous one, so data can</span>
    <span class="c1"># still be loaded from local cache.</span>
    <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">fetch_readings</span><span class="p">(</span>
        <span class="n">start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">end</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">where</span>
    <span class="p">)</span>

    <span class="c1"># This interval is *NOT* strictly contained in the previous one, cache</span>
    <span class="c1"># will be invalidated and data will be fetched from server.</span>
    <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">fetch_readings</span><span class="p">(</span>
        <span class="n">start</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
        <span class="n">end</span><span class="p">,</span>
        <span class="n">where</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="note-about-asyncio">
<h3>Note about <em>asyncio</em><a class="headerlink" href="#note-about-asyncio" title="Permalink to this headline">¶</a></h3>
<p>This library uses the <em>asyncio</em> framework.
This means that all functions and methods are actually coroutines, and they need to be called accordingly.
The caller can retrieve the event loop, and explicitly execute a coroutine</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
    <span class="n">smap</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Otherwise, if the caller is itself a coroutine, it can use the corresponding syntax in Pyhton 3.5+</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">async</span> <span class="k">def</span> <span class="nf">external_coroutine</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">await</span> <span class="n">smap</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="command-line-utility">
<h2>Command Line Utility<a class="headerlink" href="#command-line-utility" title="Permalink to this headline">¶</a></h2>
<p>This library includes a command line utility named <code class="docutils literal"><span class="pre">smap</span></code>, which can be used to retrieve and plot data from sMAP archiver.</p>
<div class="highlight-guess"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="o">:</span> <span class="n">smap</span> <span class="o">[-</span><span class="n">h</span><span class="o">]</span> <span class="o">[-</span><span class="n">v</span><span class="o">]</span> <span class="o">--</span><span class="n">url</span> <span class="n">URL</span> <span class="o">[--</span><span class="n">plot</span><span class="o">]</span> <span class="o">[--</span><span class="n">plot</span><span class="o">-</span><span class="n">markers</span><span class="o">]</span> <span class="o">[--</span><span class="n">csv</span><span class="o">]</span>
            <span class="o">[--</span><span class="n">start</span> <span class="n">DATETIME</span><span class="o">]</span> <span class="o">[--</span><span class="n">end</span> <span class="n">DATETIME</span><span class="o">]</span>
            <span class="n">WHERE</span>

<span class="n">Fetch</span> <span class="n">data</span> <span class="n">from</span> <span class="n">sMAP</span>

<span class="n">positional</span> <span class="k">arguments</span><span class="o">:</span>
  <span class="n">WHERE</span>             <span class="n">sMAP</span> <span class="n">query</span> <span class="n">where</span>

<span class="n">optional</span> <span class="k">arguments</span><span class="o">:</span>
  <span class="o">-</span><span class="n">h</span><span class="o">,</span> <span class="o">--</span><span class="n">help</span>        <span class="n">show</span> <span class="k">this</span> <span class="n">help</span> <span class="n">message</span> <span class="n">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">v</span><span class="o">,</span> <span class="o">--</span><span class="n">verbose</span>     <span class="n">increase</span> <span class="n">output</span>
  <span class="o">--</span><span class="n">url</span> <span class="n">URL</span>         <span class="n">sMAP</span> <span class="n">archiver</span> <span class="n">URL</span>
  <span class="o">--</span><span class="n">plot</span>            <span class="n">plot</span> <span class="n">results</span>
  <span class="o">--</span><span class="n">plot</span><span class="o">-</span><span class="n">markers</span>    <span class="n">show</span> <span class="n">plot</span> <span class="n">markers</span>
  <span class="o">--</span><span class="n">csv</span>             <span class="n">print</span> <span class="n">results</span> <span class="n">to</span> <span class="n">stdout</span> <span class="k">in</span> <span class="n">CSV</span> <span class="n">format</span>
  <span class="o">--</span><span class="n">start</span> <span class="n">DATETIME</span>  <span class="n">initial</span> <span class="n">time</span> <span class="o">(</span><span class="k">default</span><span class="o">:</span> <span class="mi">24</span><span class="n">h</span> <span class="n">ago</span><span class="o">)</span>
  <span class="o">--</span><span class="n">end</span> <span class="n">DATETIME</span>    <span class="kd">final</span> <span class="n">time</span> <span class="o">(</span><span class="k">default</span><span class="o">:</span> <span class="n">now</span><span class="o">)</span>
</pre></div>
</div>
<p>For instance, to export a single time-series to CSV file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>smap --url http://hostname.com:8079 <span class="s2">&quot;uuid = &#39;12345678-1234-1234-1234-12345678abcd&#39;&quot;</span> <span class="se">\</span>
    --start <span class="m">2018</span>-01-17T00:00:00Z --csv -vv &gt; output.csv
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reference.html" class="btn btn-neutral float-right" title="Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="CFEI Python sMAP Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Center for Energy Informatics, University of Southern Denmark.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>